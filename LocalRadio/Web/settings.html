
  <script>
        function applyMP3Settings(form)
        {
          //console.log("frequencyListenButtonClicked");

            var bitrateSelect = document.getElementById("bitrate_select");
            var bitrateOptions = bitrateSelect.children;
            var bitrateIndex = bitrateSelect.selectedIndex;
            var bitrateSelectedOption = bitrateOptions[bitrateIndex];
            var bitrate = bitrateSelectedOption.value;

            var encodingQualitySelect = document.getElementById("encoding_quality_select");
            var encodingQualityOptions = encodingQualitySelect.children;
            var encodingQualityIndex = encodingQualitySelect.selectedIndex;
            var encodingQualitySelectedOption = encodingQualityOptions[encodingQualityIndex];
            var encoding_quality = encodingQualitySelectedOption.value;

            var mp3SettingsArray = {bitrate: bitrate, encoding_quality: encoding_quality};

            var jsonData = JSON.stringify(mp3SettingsArray);

            // request to HTTP server to set radio tuning
            var getUrl = window.location;
            var baseUrl = getUrl .protocol + "//" + getUrl.host + "/";
            var applyMP3SettingsButtonClickedUrl = baseUrl + "applymp3settings.html";

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
              //console.log("readyState="+this.readyState+", status="+this.status);
              if (this.readyState == 4 && this.status == 200) {
                // response received ok
                alert("The MP3 streaming settings were changed, and the servers are restarting.  Press the ► Play button to start audio.")
              }
            };
            xhttp.open("POST", applyMP3SettingsButtonClickedUrl, true);
            xhttp.send(jsonData);

            // handle the audio tag with the new source
            //window.top.postMessage("startaudio", "*");

            //console.log("postMessage startaudio");
        }
  </script>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->

    <div class="container">
        <section class="header">
            <h2 class="title">Settings</h2>
            <h3 class="title">MP3 Streaming</h3>
            <form class="wbfm-tuner-form" id="wbfm-tuner-form" onsubmit="event.preventDefault(); return applyMP3Settings(this);" method="POST">

                <label for="bitrate_select">Bitrate:</label>
                <select class="twelve columns value-prop" id="bitrate_select" name="bitrate_select">
                    %%MP3_BITRATE_SELECT%%
                </select>

                <br>
                
                <label for="encoding_quality_select">Encoding Quality:</label>
                <select class="twelve columns value-prop" id="encoding_quality_select" name="encoding_quality_select">
                    %%MP3_ENCODING_QUALITY_SELECT%%
                </select>

                <br>&nbsp;
                <br>

                <input class="twelve columns button button-primary" type="button" value="Save Changes and Restart" onclick="event.preventDefault(); return applyMP3Settings(this);">
            </form>
            <br>&nbsp;
            <br>
            Restarting will stop current audio stream.
        </section>

        
    </div>

